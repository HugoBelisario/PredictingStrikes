# Predicting Strikes In Baseball

## Research Question and Overview

A strike is defined as a pitch that is counted against the batter. For a pitch to be called a strike, the batter can either swing and miss on the pitch, let it pass through the strike zone without swinging or hit it foul (unless there are two strikes that have already been called). For pitchers, the ability to throw strikes consistently is extremely valuable and widely sought after by Major League Baseball teams. It clearly displays an exceptional level of control or ability to stay ahead in the pitch count against a hitter and a higher chance of producing outs which is the pitcher’s main responsibility. 

To improve our knowledge of pitcher quality, we decided to build a model to predict whether a given pitch would result in a strike. We built a logistic model using an indicator variable for whether or not a certain pitch was a strike as our response. To give the project a specific (and interesting) context, we chose to build the model using data from the top five relief pitchers in the New York Yankees bullpen, which is projected to be the number one bullpen in baseball according to various sources.  

Note: Before last season’s trade deadline, the Yankees acquired Zach Britton from the Baltimore Orioles and this past offseason, the club inked Adam Ottavino to a three-year deal. The Yankees bullpen was already amongst the best in baseball with Aroldis Chapman and Dellin Betances leading the group, however, after the previously mentioned acquisitions and transitioning Chad Green from the starting rotation to the bullpen,  they were further solidified as the top projected bullpen in terms of WAR (Wins Above Replacement). Each pitcher possesses an elite pitch that separates them from the rest of the league: Chapman’s 100+ MPH fastball, Ottavino’s baffling slider, Betances’ knuckle curve, Britton’s Mariano Rivera-esque cutter, and Chad Green’s fastball with added backspin resulting in frequent swing and misses.

## Our Dataset 
Our data came from a website called Baseball Savant. Baseball Savant  has partnered with the MLB to provide specific statistics regarding certain aspects of each pitch thrown. These statistics include, but are not limited to, things like: pitch type, pitch speed, pitch and hit location, the in-game situation, and the result of the play. Given that we were interested in the probability of a strike on a given pitch,  we were only interested in variables which provided information about the pitch before a the result of the pitch (variables such as hit direction were irrelevant). To make our dataset and model more comprehensive, we supplemented our dataset by joining it with other variables we deemed important: including, indicator variables for pitch types, pitchers, and if a game was in extra innings. 

To build our model we split our data into three sets. The first split was made to create a dataset to be used in our EDA. We set aside a random sample of 30% of our original data for this purpose. Next, during the model building and selection phase, we split the remaining data into a training dataset, upon which our model would be built, and a test dataset, upon which the accuracy of our model built from the training set could be tested. Of the remaining 70% of the overall data, a random sample of 85% was used in the training set and the remaining 15% was used for the test set. Because we had a relatively large set of data, we felt these splits were appropriate and that random sampling would create sample sets which were reflective of the overall data and reduce bias.

### Variable EDA: what did we need to learn from EDA
The EDA showed us a number of interesting effects that certain predictors had on the response. First, we examined the effect that each pitcher would have on the model. We found that in terms of individual strike percentage, they ranked as follows: Betances, Green, Chapman, Ottavino, and lastly Britton. 

Second, we investigated the effects of pitch type on strike proportion. From our data, we found that the knuckle curveball resulted in the highest proportion of strikes. However, only Betances (who also ranked as the best pitcher) throws this pitch. The four-seam fastball was by far the most common pitch, and also ranked as the second most likely pitch to be a strike. Thus, it was the most commonly effective pitch. In general, we cross-referenced a pitch’s relative  performance with its frequency to determine whether or not it is thrown enough. This framework helped us determine that sinkers are thrown too frequently because they are the third most common pitch despite performing the second worst. One problem with the pitch type predictor is the disparity in the different pitches used by each pitcher. Pitch type is very reliant on the pitcher and this results in certain pitches being more or less frequent, which is difficult to account for in the model.

Our next few predictors gave fairly obvious results. The first was that the zone predictor yielded that pitches thrown in the strike zone are more likely to be strikes. This makes sense because pitches outside the zone would likely not be called strikes, and also would be swung at less frequently. Pitch speed and spin rate yielded intuitive conclusions that we expected. On average, higher pitch speed and spin rate means higher strike percentage. However, we were surprised that they were not as powerful of predictors as we thought. This could be because the pitch speed and spin rate are directly affected by pitch type, and we did not investigate the interaction terms between them.

Next, we investigated the effects of count, outs, and the two combined on strike percentage. There seemed to be few clear patterns with these predictors, but we did find that strikes are more common on a full count, and that they are also more common with one out. Interestingly, a 2-0  count with one out produces the highest proportion of strikes.

Then, we looked at the matchup of the handedness of pitcher vs batter. Here, we found that the right-handed pitchers are quite a bit more likely to throw a strike on any given pitch than the left-handed pitchers, regardless of the handedness of the batter that they are facing. Because of our small dataset, a single outlier may confound our results which is the case with Zach Britton a left-hander who pitched a bad year last year (he was ranked least likely to throw a strike in our initial rankings). 

Lastly, we investigated the effects that the inning has on strike likelihood. The only clear conclusion from this was that strikes are about two percent more likely on average in extra innings. Inside the regular innings, there is no clear pattern of increased or decreased pitcher success.

## Model Building and Selection

### Ridge Regression
The first model we built was a ridge regression model using the predictors we selected through our EDA. It is worth noting that dummy variables for a 4-seam fastball, Aroldis Chapman and the down zone were all removed for comparison purposes. As a result, the intercept carries the value of Aroldis Chapman throwing a 4-seam fastball to the lower third of the strike zone. We began by finding an appropriate tuning parameter, lambda, for our data. In ridge regression, lambda works by penalizing additional variables, and thus, more complexity. This penalization causes lasso and ridge regression to artificially select smaller models by shrinking variables’ coefficients towards zero. Logically, variables with the best predictive power earn the highest coefficients. In ridge regression, the tuning parameter does not completely remove any variables.  We selected this lambda by searching within a grid and then running a 10-fold cross validation on our data to select appropriate values of lambda. We used two values of lambda in our analysis, the test MSE minimizing value of lambda and the value of lambda that was one standard error away from the minimum value. Our resulting values were 0.01 and 0.0529, respectively. We chose to include the “less accurate” model (one SE) because, although it assumes less certainty, it generally eliminates more variables, which keeps in line with our goal to build the simplest accurate model possible.

Our use of two lambda values resulted in two models. Their predictors and coefficients can be seen in Figure IV.a. Looking at the coefficients we are able to notice some interesting things. First, variables denoting pitch location (zone, up_zone, mid_zone), release position (release_pos_x, release_pos_z) and pitch type (all predictors from knuckle_curve through changeup) tend to have larger coefficients in both models. Location is likely important because if a pitch is outside of the strike zone, it will not be called a strike by an umpire and will likely not be swung at by the batter. Release position is perhaps important because it affects where a ball will end up within the strike zone. Finally, pitch type is likely important due to the fact that, as we have saw through our EDA, some pitches are simply much harder to hit than others.

It is also interesting to look at the variables that have smaller coefficients in both models. Particularly, variables measuring speed (release_speed, effective_speed), spin rate (release_spin_rate), pitch count (pitch_count), batting stance (standL, standR) and score (field_lead) are all deemed to be less predictive by the models.

Test errors and confusion matrices can be seen in Figure IV.b. and IV.c. It appears that the models are quite similar, but that the model using a value of lambda one standard error away from the minimum test MSE performs slightly better, having a test error of 0.240 rather than 0.242. It is also interesting to note that this difference in test error is due to a difference of a single prediction where the model using the test MSE minimizing value of lambda incorrectly predicts a non-strike as a strike, but the other model does not.

### Lasso
We also built a lasso model using the same original predictors found in our EDA. The lasso is a very similar type of model to the ridge regression model in that it also relies on a tuning parameter, lambda, to appropriately weight its predictors. However, unlike ridge regression, lambda values in a lasso model do sometimes shrink predictors down to values so small that they are removed from the model. We again used cross-validation to select lambda values which were at the test MSE minimizing value and one standard error away from this value. This time, we found our lambda values to be 0.006 and 0.033, respectively.

These lambda values resulted in the models shown in Figure VI.d. As can be seen, in both models many predictors have been shrunken to zero. Both models, as we found in ridge regression, again consider zone important. The lasso_1se model considers these predictors so important that zone variables are the only predictors still included in the model. It is also interesting to look at the other predictors chosen by the lasso_min. This model seems to also highly value the pitcher in the game (betances, britton, ottavino) and the number of strikes thrown during the at-bat (strikes), and then minorly value inning and spin rate. Of these variables, including the pitchers is the most interesting to us. These variables were given moderately large coefficients in the ridge regression models, but did not stand out as being extremely large. That being said, it makes sense that these are included because each pitcher has a slightly different style and ability. 

Figures IV.e. and IV.f. show confusion matrices for both models. As can be seen, both actually make the same predictions and ultimately have the same test error, about 0.242, as our ridge regression model using the test MSE minimizing value of lambda.

Ultimately, we chose the model produced by using lasso regression with a lambda value one standard away from the test MSE. This model only mispredicted one extra pitch, but is a much simpler model. It uses only three variables compared with the ridge method which uses 33. As a result, we conclude that this model is our best model.

### ROC Curve & Performance at Varying Threshold Values
Since we were working with a logistic regression, we decided to look into what would happen if we changed the threshold probability for which our chosen model would consider a given observation would be a strike. Our original model used a value of 0.5, meaning that if the model predicted that there was a more than 50% chance that a given observation would be considered a strike, it would predict it to be a strike. Otherwise, it would predict that the observation was not a strike. 

In order to find out the optimal level for this threshold, we created an ROC curve. ROC curves plot the number of true positives against the number of false positives. Ideally, we would like to maximize our true positive rate, while minimizing false positives, as this will create the most accurate model. The ROC curve we created for our final model can be seen in Figure V.a.

The green section of this graph shows the threshold values for which our true/false positive rate is optimized. It appears that anywhere between around 0.4 and 0.6 falls within this range. We then tested a variety of values in this range and found that 0.5 performed the best, confirming the assumption we made in our original model. 

## Further improvements
While the final model correctly identified about 76% of pitches, it has room for a number of improvements. Our preliminary EDA coupled with our team members’ domain knowledge of baseball indicates that a few variables had much lower coefficients than hypothesized. The most probable explanation for this is the lack of interaction terms in our model. For example, pitch speed does not factor much into our model, but different pitches are thrown at different speeds; the same is true for pitch spin. Thus an interaction term with pitch type would capture all of this information. Similarly, the zone variable we use is not flipped for righties and lefties, which negatively impacts the predictive power of zone. It is much better to identify a ball as high and close to the body than as an arbitrary spot in the strike zone. Finally, we expect pitcher interaction terms will add considerable accuracy to our model because pitchers have so many unique characteristics.

